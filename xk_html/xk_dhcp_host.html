<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="DnsMasqWeb - Desgin By Xiaok">
		<meta name="author" content="Xiaok">
		<title>{{ _('DHCP Management') }} - DnsMasqWeb - Desgin By Xiaok</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="/xk_static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="/xk_static/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="/xk_static/css/xk_dnsmasqweb.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			{% include "xk_top_nav.html" %}
			<div class="row">
				{% include "xk_nav.html" %}
				<div class="span10">
					<h4>DHCP{{ _('Binding Rules') }} | <a href="/dhcp/pool">{{ _('Address Pool Management') }}</a></h4>
                    <div class="pull-right">
                        <input type="button" class="btn btn-primary" value="添加规则" onclick="show_add();">
                        <input type="button" class="btn btn-warning" value="刷新配置" onclick="reload_dhcp('normal')">
                    </div><br /><br />

                    <form class="form-horizontal display_no" id="add_line" method="post">
						<fieldset>
                            <div class="control-group">
								<label class="control-label" for="hostname">{{ _('CPU Name') }}</label>
								<div class="controls">
									<input type="text" class="input-xlarge" id="hostname" name="hostname"/>
								</div>
							</div>
                            <div class="control-group">
								<label class="control-label" for="mac">{{ _('MAC Address') }}</label>
								<div class="controls">
									<input type="text" class="input-xlarge" id="mac" name="mac"/>
								</div>
							</div>
                            <div class="control-group">
								<label class="control-label" for="ip">{{ _('IP Address') }}</label>
								<div class="controls">
									<input type="text" class="input-xlarge" id="ip" name="ip"/>
								</div>
							</div>
                            <div class="control-group">
								<label class="control-label" for="action">规则{{ _('Action') }}</label>
								<div class="controls">
									<select name="action" id="action">
                                        <option value="allow">允许</option>
                                        <option value="ignore">禁止</option>
									</select>
								</div>
							</div>
                            <div class="control-group">
								<label class="control-label" for="comment">{{ _('Remark') }}信息</label>
								<div class="controls">
									<input type="text" class="input-xlarge" id="comment" name="comment" />
								</div>
							</div>
							<div class="form-actions">
								<a href="javascript:void(0)" class="btn" onclick="cancel_add();">取消</a>　　<a href="javascript:void(0);" class="btn btn-primary" onclick="add_dhcp_host()">保存</a>
							</div>
						</fieldset>
					</form>

					<table id="DataList" class="table table-bordered table-striped table-hover table-condensed">
						<thead>
							<tr>
								<th><input type="checkbox" id="checkbox_all"> #</th>
                                <th>{{ _('CPU Name') }}</th>
								<th>{{ _('MAC Address') }}</th>
								<th>{{ _('IP Address') }}</th>
								<th>{{ _('Action') }}</th>
                                <th>{{ _('Remark') }}</th>
                                <th>{{ _('Operation') }}</th>
							</tr>
						</thead>
						<tbody>
                            {% for d in dhcp_hosts %}
                            {% if d['status'] == 'yes' %}
                            <tr id="line_{{d['id']}}">
                            {% set st_msg = "暂停" %}
                            {% set fun_value = "no" %}
                            {% else %}
							<tr id="line_{{d['id']}}" class="error">
                            {% set st_msg = "开启" %}
                            {% set fun_value = "yes" %}
                            {% end %}
                            {% if d['action'] == 'allow' %}
                                {% set action = '已允许' %}
                                {% set action_value = 'ignore' %}
                                {% set action_msg = "禁止" %}
                            {% else %}
                                {% set action = '已禁止' %}
                                {% set action_value = 'allow' %}
                                {% set action_msg = "允许" %}
                            {% end %}
								<td><input type="checkbox"/> {{ loop.index }}</td>
                                <td>{{ d['hostname'] }}</td>
                                <td>{{ d['mac'] }}</td>
                                <td>{{ d['ip'] }}</td>
                                <td><a href="/public/api?module=dhcp_host&fun=ch_action&id={{d['id']}}&value={{action_value}}" onclick="return confirm('确认{{action_msg}}该{{ _('records') }}？');" title="点击{{action_msg}}该{{ _('records') }}">{{ action }}</a></td>
                                <td>{{ d['comment'] or '' }}</td>
                                <td>
                                    <a href="javascript:void(0);" onclick="to_edit({{d['id']}})">{{ _('Edit') }}</a> |
                                    <a href="/public/api?module=dhcp_host&fun=ch_status&id={{d['id']}}&value={{fun_value}}" onclick="return confirm('确认{{st_msg}}{{ _('records') }}？');">{{st_msg}}</a> |
                                    <a href="/public/api?module=dhcp_host&fun=del&id={{d['id']}}" onclick="return confirm('确认{{ _('Delete') }}该{{ _('records') }}？');">{{ _('Delete') }}</a>
                                </td>
							</tr>
                            {# 可{{ _('Edit') }}状态 #}
                            <tr id="edit_line_{{d['id']}}" class="display_no">
                                <td><input type="checkbox"/> {{ loop.index }}</td>
                                <td><input type="text" class="input-medium" value="{{d['hostname']}}" name="hostname_{{d['id']}}" id="hostname_{{d['id']}}"></td>
                                <td><input type="text" class="input-medium" value="{{d['mac']}}" name="mac_{{d['id']}}" id="mac_{{d['id']}}"></td>
                                <td><input type="text" class="input-medium" value="{{d['ip']}}" name="ip_{{d['id']}}" id="ip_{{d['id']}}"></td>
                                <td>
                                    <select name="action_{{d['id']}}" id="action_{{d['id']}}" style="width: 70px">
                                        <option value="allow" {{d['allow_selected']}}>允许</option>
                                        <option value="ignore" {{d['ignore_selected']}}>禁止</option>
                                    </select>
                                </td>
                                <td><input type="text" class="input-medium" value="{{d['comment'] or ''}}" name="comment_{{d['id']}}" id="comment_{{d['id']}}"></td>
                                <td>
                                    <a href="javascript:void(0);" onclick="save_info({{d['id']}});">保存</a> |
                                    <a href="javascript:void(0);" onclick="to_line({{d['id']}})">取消</a>
                                </td>
                            </tr>
                            {% end %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<script src="/xk_static/js/jquery-1.8.3.min.js"></script>
        <script src="/xk_static/bootstrap/js/bootstrap.min.js"></script>
		<script src="/xk_static/js/xk_dnsmasqweb.js"></script>
        <script src="/xk_static/js/xk_dhcp.js"></script>
        <script type="text/javascript">
            function add_dhcp_host() {
                hostname = $("#hostname").val();
                mac = $("#mac").val();
                ip = $("#ip").val();
                action = $("#action").val();
                comment = $("#comment").val();
                if ( mac == '') {
                    alert("请输入{{ _('MAC Address') }}！");
                    $("#mac").focus();
                    return false;
                };
                if ( ip == '') {
                    alert("请输入{{ _('IP Address') }}！");
                    $("#ip").focus();
                    return false;
                };
                $.ajax({
                    type: "POST",
                    url: "/dhcp/host",
                    data: { 'hostname':hostname, 'mac':mac, 'ip':ip, 'action':action, 'comment':comment },
                    dataType: "text",
                    success: function(msg){
                        if (msg == "1") {
                            alert("添加成功！");
                            window.location.href="/dhcp/host";
                        } else if (msg == "2") {
                            alert("{{ _('MAC Address') }}已存在！");
                            $("#mac").focus();
                            return false;
                        } else if (msg == "3") {
                            alert("{{ _('IP Address') }}已存在！");
                            $("#ip").focus();
                            return false;
                        } else {
                            alert("提示：添加规则失败！");
                            return false;
                        }
                        },
                    error:function(){
                        alert("{{ _('Note: Internal Server Error') }}！");
                        return false;
                        },
                    });
            };
            function show_add(){
                $("#add_line").removeClass("display_no");
                $("#DataList").addClass("display_no");
                $("#hostname").focus();
            };
            function cancel_add(){
                $("#add_line").addClass("display_no");
                $("#DataList").removeClass("display_no");
            };
            function to_edit(id){
                show_id = "#line_" + id;
                edit_id = "#edit_line_" + id;
                $(show_id).addClass("display_no");
                $(edit_id).removeClass("display_no");
            };
            function to_line(id){
                show_id = "#line_" + id;
                edit_id = "#edit_line_" + id;
                $(show_id).removeClass("display_no");
                $(edit_id).addClass("display_no");
            };
            /* {{ _('Edit') }}保存{{ _('records') }} */
            function save_info(id){
                hostname = $("#hostname_"+id).val();
                mac = $("#mac_"+id).val();
                ip = $("#ip_"+id).val();
                action = $("#action_"+id).val();
                comment = $("#comment_"+id).val();
                $.ajax({
                    type: "POST",
                    url: "/dhcp/host",
                    data: { "id":id, "hostname":hostname, "mac":mac, "ip":ip, "action":action, "comment":comment, "fun":"edit" },
                    dataType: "text",
                    success: function(msg){
                        if (msg == "1") {
                            alert("修改成功！");
                            location.href="/dhcp/host";
                        } else if (msg == "2") {
                            alert("{{ _('MAC Address') }}已存在！");
                            $("#mac_"+id).focus();
                            return false;
                        } else if (msg == "3") {
                            alert("{{ _('IP Address') }}已存在！");
                            $("#ip_"+ip).focus();
                            return false;
                        } else {
                            alert("提示：修改失败！");
                            return false;
                        }
                        },
                    error:function(){
                        alert("{{ _('Note: Internal Server Error') }}！");
                        return false;
                        },
                    });
            };
        </script>
        {% include "xk_footer.html" %}
	</body>
</html>
